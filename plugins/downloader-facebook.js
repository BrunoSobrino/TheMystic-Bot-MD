import fetch from 'node-fetch'
import { facebookDl } from './scraper.js'
import { savefrom, facebookdl, facebookdlv2 } from '@bochilteam/scraper'
import fbDownloader from 'fb-downloader-scrapper'
let handler = async (m, { conn, args, command, usedPrefix }) => {
if (!args[0]) throw `*[â—ğˆğğ…ğâ—] ğ™¸ğ™½ğ™¶ğšğ™´ğš‚ğ™´ ğš„ğ™½ ğ™´ğ™½ğ™»ğ™°ğ™²ğ™´ ğ™³ğ™´ ğ™µğ™°ğ™²ğ™´ğ™±ğ™¾ğ™¾ğ™º, ğ™´ğ™¹ğ™´ğ™¼ğ™¿ğ™»ğ™¾: ${usedPrefix + command}* https://fb.watch/fOTpgn6UFQ/` 
if (!args[0].match(/www.facebook.com|fb.watch/g)) throw `*[â—ğˆğğ…ğâ—] ğ™¸ğ™½ğ™¶ğšğ™´ğš‚ğ™´ ğš„ğ™½ ğ™´ğ™½ğ™»ğ™°ğ™²ğ™´ ğ™³ğ™´ ğ™µğ™°ğ™²ğ™´ğ™±ğ™¾ğ™¾ğ™º, ğ™´ğ™¹ğ™´ğ™¼ğ™¿ğ™»ğ™¾: ${usedPrefix + command}* https://fb.watch/fOTpgn6UFQ/`
try {
await m.reply(`*[â—] á´…á´‡sá´„á´€Ê€É¢á´€É´á´…á´ sá´œ á´ Éªá´…á´‡á´, á´€É¢á´œá´€Ê€á´…á´‡ á´œÉ´ á´á´á´á´‡É´á´›á´ á´˜á´Ê€ Ò“á´€á´ á´Ê€, á´‡sá´›á´‡ á´˜Ê€á´á´„á´‡sá´ á´˜á´œá´‡á´…á´‡ á´…á´œÊ€á´€Ê€ á´‡É´á´›Ê€á´‡ 2 Ê 10 á´ÉªÉ´á´œá´›á´s á´…á´‡á´˜á´‡É´á´…Éªá´‡É´á´…á´ á´…á´‡ ÊŸá´€ á´…á´œÊ€á´€á´„Éªá´É´ á´…á´‡ÊŸ á´ Éªá´…á´‡á´...*`)
switch (command) {    
case "facebook": case "fb": case "facebookdl": case "fbdl":                
let res = await fbDownloader(args[0])
for (let result of res.download) {
let ur = result.url    
await conn.sendMessage(m.chat, { video: { ur }, caption: '*ğ™°ğš€ğš„ğ™¸ ğ™´ğš‚ğšƒğ™° ğš‚ğš„ ğš…ğ™¸ğ™³ğ™´ğ™¾*' }, { quoted: m })}
break      
case "facebook2": case "fb2": case "facebookdl2": case "fbdl2":                  
let ress = await facebookDl(args[0]).catch(async _ => await savefrom(args[0])).catch(_ => null)
let urll = ress?.url?.[0]?.url || ress?.url?.[1]?.url || ress?.['720p'] || ress?.['360p']
await conn.sendMessage(m.chat, { video: { urll }, caption: '*ğ™°ğš€ğš„ğ™¸ ğ™´ğš‚ğšƒğ™° ğš‚ğš„ ğš…ğ™¸ğ™³ğ™´ğ™¾*' }, { quoted: m })    
break
case "facebook3": case "fb3": case "facebookdl3": case "fbdl3":   
let res3 = await fetch(`https://latam-api.vercel.app/api/facebookdl?apikey=brunosobrino&q=${args[0]}`)  
let json = await res3.json()
let url3 = json.video
await conn.sendMessage(m.chat, { video: { url3 }, caption: '*ğ™°ğš€ğš„ğ™¸ ğ™´ğš‚ğšƒğ™° ğš‚ğš„ ğš…ğ™¸ğ™³ğ™´ğ™¾*' }, { quoted: m })    
break    
case "facebook4": case "fb4": case "facebookdl4": case "fbdl4":   
const { result } = await facebookdl(args[0]).catch(async _ => await facebookdlv2(args[0]))
for (const { url, isVideo } of result.reverse()) await conn.sendMessage(m.chat, { video: { url }, fileName: `error.mp4`, mimetype: 'video/mp4' , caption: '*ğ™°ğš€ğš„ğ™¸ ğ™´ğš‚ğšƒğ™° ğš‚ğš„ ğš…ğ™¸ğ™³ğ™´ğ™¾*' }, { quoted: m })    
break    
case "facebook5": case "fb5": case "facebookdl5": case "fbdl5":
let vio = await fetch(`https://api.violetics.pw/api/downloader/facebook?apikey=beta&url=${args[0]}`)  
let vioo = await vio.json()
let videovio = `${vioo.result.hd.url || vioo.result.sd.url}`
await conn.sendFile(m.chat, videovio, `error.mp4`, '*ğ™°ğš€ğš„ğ™¸ ğ™´ğš‚ğšƒğ™° ğš‚ğš„ ğš…ğ™¸ğ™³ğ™´ğ™¾*', m)
break
}} catch {
await m.reply('*[â—ğˆğğ…ğâ—] ğ™´ğšğšğ™¾ğš, ğ™¿ğ™¾ğš ğ™µğ™°ğš…ğ™¾ğš ğš…ğš„ğ™´ğ™»ğš…ğ™° ğ™° ğ™¸ğ™½ğšƒğ™´ğ™½ğšƒğ™°ğšğ™»ğ™¾*\n\n*- ğ™²ğ™¾ğšğšğ™¾ğ™±ğ™¾ğšğ™´ ğš€ğš„ğ™´ ğ™´ğ™» ğ™´ğ™½ğ™»ğ™°ğ™²ğ™´ ğš‚ğ™´ğ™° ğš‚ğ™¸ğ™¼ğ™¸ğ™»ğ™°ğš ğ™°:*\n*â—‰* https://fb.watch/fOTpgn6UFQ/')
}}
handler.command = /^(facebook|fb|facebookdl|fbdl|facebook2|fb2|facebookdl2|fbdl2|facebook3|fb3|facebookdl3|fbdl3|facebook4|fb4|facebookdl4|fbdl4|facebook5|fb5|facebookdl5|fbdl5)$/i
export default handler   
